import{ShaderMaterial as A,UniformsUtils as I,Color as g,Vector3 as C,Mesh as Q,ShaderLib as B,BufferGeometry as i,InterleavedBuffer as E,BufferAttribute as o,InterleavedBufferAttribute as e,Sphere as h,Group as t,DataTexture as s,RGBFormat as D,UnsignedByteType as a,RedFormat as r,FloatType as c,sRGBEncoding as n}from"three";class N extends Q{static getMaterial(){const{uniforms:Q,vertexShader:i,fragmentShader:E}=B.basic;return new A({uniforms:{...I.clone(Q),aoEnabled:{value:!0},aoIntensity:{value:.05},colors:{value:[...Array(6)].map(((A,I)=>(new g).setScalar(I/5)))},colorsEnabled:{value:!0},colorMapOffset:{value:new C},colorMapSize:{value:new C}},vertexShader:i.replace("#include <common>",["attribute float data;","uniform vec3 colors[6];","uniform bool aoEnabled;","uniform float aoIntensity;","uniform bool colorsEnabled;","uniform vec3 colorMapOffset;","uniform vec3 colorMapSize;","const vec2 uvoffset[4] = vec2[4](vec2(0.5, -0.5), vec2(-0.5, -0.5), vec2(-0.5, 0.5), vec2(0.5, 0.5));","#include <common>"].join("\n")).replace("#include <uv_vertex>",["int corner = int(data) >> 4;","vUv.xy = (position.xz + colorMapOffset.xz + uvoffset[corner]) / colorMapSize.xz;","vUv.y = 1.0 - vUv.y;"].join("\n")).replace("#include <color_vertex>",["vColor.xyz = vec3(1.0);","if (aoEnabled) {","  float ao = float(int(data) & 0xF) * aoIntensity;","  vColor.xyz -= ao;","}","if (colorsEnabled) {","  float colorStep = (position.y + colorMapOffset.y) / colorMapSize.y * 5.0;","  vColor.xyz *= mix(colors[int(floor(colorStep))], colors[int(ceil(colorStep))], fract(colorStep));","}"].join("\n")),fragmentShader:E,vertexColors:!0})}constructor({x:A,y:I,z:g,geometry:Q,material:B,origin:E}){super(new i,B),this.update(Q),this.colorMapOffset=new C(A,I,g),this.position.set(E.x+A,I,E.z+g),this.updateMatrixWorld(),this.matrixAutoUpdate=!1}dispose(){const{geometry:A}=this;A.dispose()}onBeforeRender(){const{colorMapOffset:A,material:I}=this;I.uniforms.colorMapOffset.value.copy(A),I.uniformsNeedUpdate=!0}update({bounds:A,indices:I,vertices:g}={}){if(!I||!I.length)return void(this.visible=!1);const{geometry:C}=this;g=new E(g,4),C.setIndex(new o(I,1)),C.setAttribute("position",new e(g,3,0)),C.setAttribute("data",new e(g,1,3)),null===C.boundingSphere&&(C.boundingSphere=new h),C.boundingSphere.set({x:A[0],y:A[1],z:A[2]},A[3]),this.visible=!0}}function w(A){return function(A,I,g,C){function Q(A,I,g){var C=g?WebAssembly.instantiateStreaming:WebAssembly.instantiate,Q=g?WebAssembly.compileStreaming:WebAssembly.compile;return I?C(A,I):Q(A)}var B=null,i="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node;if(I&&i){var E=require("fs"),o=require("path");return new Promise(((A,g)=>{E.readFile(o.resolve(__dirname,I),((I,B)=>{null!=I&&g(I),A(Q(B,C,!1))}))}))}if(I)return Q(fetch(I),C,!0);if(i)B=Buffer.from(g,"base64");else{var e=globalThis.atob(g),h=e.length;B=new Uint8Array(new ArrayBuffer(h));for(var t=0;t<h;t++)B[t]=e.charCodeAt(t)}if(A){var s=new WebAssembly.Module(B);return C?new WebAssembly.Instance(s,C):s}return Q(B,C,!1)}(0,null,"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",A)}class y{constructor({width:A,height:I,depth:g,chunkHeight:C=128,chunkSize:Q=32,onLoad:B}){if(A%Q||g%Q)throw new Error("width and depth must be multiples of chunkSize");this.chunks={x:A/Q,z:g/Q},this.chunkHeight=C,this.chunkSize=Q,this.width=A,this.height=I,this.depth=g;const i=Math.ceil(Q*Q*.5)*(4*Math.min(I,255)+1),E=[{id:"bounds",type:Float32Array,size:4},{id:"heightmap",type:Float32Array,size:A*g},{id:"vertices",type:Uint8Array,size:4*i*4},{id:"indices",type:Uint32Array,size:6*i},{id:"world",type:Int32Array,size:3}],o=Math.ceil(E.reduce(((A,{type:I,size:g})=>A+g*I.BYTES_PER_ELEMENT),0)/65536)+2,e=new WebAssembly.Memory({initial:o,maximum:o});w().then((C=>WebAssembly.instantiate(C,{env:{memory:e}}).then((C=>{this.memory=E.reduce(((A,{id:I,type:g,size:Q})=>{const B=C.exports.malloc(Q*g.BYTES_PER_ELEMENT);return A[I]={address:B,view:new g(e.buffer,B,Q)},A}),{}),this.memory.world.view.set([A,I,g]),this._mesh=C.exports.mesh,B()}))))}mesh(A,I,g){const{chunkHeight:C,chunkSize:Q,memory:B,_mesh:i}=this,E=i(B.world.address,B.heightmap.address,B.bounds.address,B.indices.address,B.vertices.address,C,Q,A*Q,I*C,g*Q);if(-1===E)throw new Error("requested chunk is out of bounds");return 0!==E&&{bounds:new Float32Array(B.bounds.view),indices:new(4*E-1<=65535?Uint16Array:Uint32Array)(B.indices.view.subarray(0,6*E)),vertices:new Uint8Array(B.vertices.view.subarray(0,4*E*4))}}}class G extends t{constructor({width:A,height:I,depth:g,generator:Q,maps:B={},onLoad:i}){super(),this.auxVector=new C;const E=new y({width:A,height:I,depth:g,onLoad:()=>{this.maps={color:new s(new Uint8Array(E.width*E.depth*3).fill(255),E.width,E.depth,D,a),height:new s(E.memory.heightmap.view,E.width,E.depth,r,c)},this.maps.color.encoding=n,this.maps.color.flipY=this.maps.height.flipY=!0,this.material=N.getMaterial(),this.material.map=this.material.uniforms.map.value=this.maps.color,this.material.uniforms.colorMapSize.value.set(E.width,E.height+1,E.depth),this.mesher=E,this.origin=new C(-.5*E.width,0,-.5*E.depth),Promise.all(Object.keys(B).reduce(((A,I)=>(A.push(this.load({map:I,url:B[I]}).catch((()=>{}))),A)),[])).then((()=>{Q&&Q(this),this.chunks=[];for(let A=0;A<E.chunks.z;A++)for(let I=0;I<E.chunks.x;I++){const g=[];for(let C=0;C<Math.ceil((E.height+1)/E.chunkHeight);C++){const Q=new N({x:I*E.chunkSize,y:C*E.chunkHeight,z:A*E.chunkSize,geometry:E.mesh(I,C,A),material:this.material,origin:this.origin});g.push(Q),this.add(Q)}this.chunks.push(g)}i&&i()}))}})}dispose(){const{chunks:A,maps:I,material:g}=this;A&&A.forEach((A=>A.forEach((A=>A.dispose())))),I&&(I.color.dispose(),I.height.dispose()),g&&g.dispose()}getHeight(A){const{auxVector:I,mesher:g,origin:C}=this;if(!g)return A.y;this.worldToLocal(I.copy(A)).sub(C).floor();const{x:Q,z:B}=I;return Q<0||Q>=g.width||B<0||B>=g.depth?I.y=0:I.y=Math.round(g.height*g.memory.heightmap.view[B*g.width+Q]),this.localToWorld(I).y}load({map:A,url:I}){const{maps:g,mesher:C}=this;if(!C)return Promise.reject();if(!this.renderer){const A=document.createElement("canvas");A.width=C.width,A.height=C.depth,this.renderer={canvas:A,ctx:A.getContext("2d")}}const{canvas:Q,ctx:B}=this.renderer;return new Promise(((C,i)=>{const E=new Image;E.crossOrigin="anonymous",E.onload=()=>{let I,i,o,e;E.width/E.height<Q.width/Q.height?(o=Q.width,e=E.height*o/E.width,I=0,i=.5*Q.height-.5*e):(e=Q.height,o=E.width*e/E.height,I=.5*Q.width-.5*o,i=0),B.clearRect(0,0,Q.width,Q.height),B.drawImage(E,0,0,E.width,E.height,I,i,o,e);const{data:h}=B.getImageData(0,0,Q.width,Q.height);for(let I=0,C=0,Q=0,B=h.length;I<B;I+=4,C+=3,Q++){const B=h[I+3]/255;["colorRGB","colorRGBheightAlpha","colorRGBheightRGB"].includes(A)&&g.color.image.data.set([h[I]*("colorRGBheightAlpha"===A?1:B),h[I+1]*("colorRGBheightAlpha"===A?1:B),h[I+2]*("colorRGBheightAlpha"===A?1:B)],C),["heightRGB","colorRGBheightRGB"].includes(A)&&(g.height.image.data[Q]=(.21*h[I]+.71*h[I+1]+.07*h[I+2])/255*B),["heightAlpha","colorRGBheightAlpha"].includes(A)&&(g.height.image.data[Q]=B),"heightR"===A&&(g.height.image.data[Q]=h[I]/255)}["colorRGB","colorRGBheightAlpha","colorRGBheightRGB"].includes(A)&&(g.color.needsUpdate=!0),["heightAlpha","heightR","heightRGB","colorRGBheightAlpha","colorRGBheightRGB"].includes(A)&&(g.height.needsUpdate=!0,this.remesh()),C()},E.onerror=()=>{i()},E.src=I}))}remesh(A){const{chunks:I,mesher:g}=this;if(!I)return;if(!A){for(let A=0,C=0;A<g.chunks.z;A++)for(let Q=0;Q<g.chunks.x;Q++,C++)I[C].forEach(((I,C)=>I.update(g.mesh(Q,C,A))));return}const C=Math.max(Math.floor(A.x*g.width/g.chunkSize)-1,0),Q=Math.max(Math.floor(A.y*g.depth/g.chunkSize)-1,0),B=Math.min(C+2,g.chunks.x-1),i=Math.min(Q+2,g.chunks.z-1);for(let A=Q;A<=i;A++)for(let Q=C;Q<=B;Q++)I[A*g.chunks.x+Q].forEach(((I,C)=>I.update(g.mesh(Q,C,A))))}}export{G as default};
